# [Feature] Display Verified Stores List in Admin Dashboard

## Problem Statement

Currently, the admin dashboard only displays pending stores in a list format (`PendingStoresList` component), while verified stores are only visualized on a map (`StoreLocationsMap`). This limitation prevents administrators from:

- Viewing a comprehensive list of all verified stores in a table format
- Managing verified stores directly from the dashboard (revoke verification, edit details)
- Tracking which stores have been verified and when
- Efficiently browsing through verified stores with pagination

**Current Limitations:**
- No tabular view of verified stores - only map visualization
- Cannot perform actions on verified stores from the dashboard
- Limited visibility into verified store details (name, owner, verification date)
- No pagination for verified stores

## User Value

This feature will provide administrators with:

1. **Complete Store Management**: Admins can view both pending and verified stores in one dashboard view, providing a complete picture of all stores on the platform
   
2. **Quick Actions**: Ability to revoke verification, edit store details, or view full details directly from the dashboard without navigating to separate pages

3. **Better Organization**: Verified stores are displayed in a 4-column grid layout alongside pending stores, recent activity, and top stores, making the dashboard more comprehensive and actionable

4. **Improved Workflow**: When a pending store is approved, it immediately appears in the verified stores list with real-time updates, allowing admins to track the entire verification lifecycle

**Concrete Examples:**
- Admin approves a pending store → Store automatically appears in verified stores list
- Admin can revoke verification for a store that violated policies → Store moves back to pending status
- Admin can quickly browse through all verified stores with pagination to find specific stores
- Admin sees store owner, verification date, and can navigate to full details with one click

## Definition of Done

- [ ] **Implementation Complete**
  - [ ] `VerifiedStoresList` component created with table display
  - [ ] Data fetching in `getAdminDashboardData` includes verified stores with pagination
  - [ ] Dashboard layout updated to 4-column grid (`lg:grid-cols-4`)
  - [ ] Verified stores displayed with: Name, Owner, Verified Date, Actions (View/Revoke/Edit)
  - [ ] Pagination implemented (server-side recommended) showing all verified stores
  - [ ] Revoke verification API endpoint created (`POST /api/admin/stores/[id]/revoke`)
  - [ ] Revoke sets status to "pending" (allows re-verification)
  - [ ] Real-time updates work when store status changes

- [ ] **Unit Tests Added** (>80% coverage)
  - [ ] `VerifiedStoresList.test.tsx` - Component rendering, actions, pagination
  - [ ] `getAdminDashboardData` tests for verified stores fetching
  - [ ] Revoke endpoint tests (`route.test.ts`)

- [ ] **Integration Tests**
  - [ ] Dashboard renders verified stores correctly
  - [ ] Pagination fetches correct stores per page
  - [ ] Revoke verification updates store status
  - [ ] Real-time updates sync between pending and verified lists

- [ ] **Documentation Updated**
  - [ ] JSDoc comments on new components
  - [ ] Component props and interfaces documented
  - [ ] API endpoint documented
  - [ ] Translation keys documented

- [ ] **Code Review Approved**
  - [ ] Follows existing component patterns (`PendingStoresList` reference)
  - [ ] TypeScript types properly defined
  - [ ] Responsive design tested

- [ ] **CI/CD Passes**
  - [ ] All tests pass
  - [ ] No linting errors
  - [ ] Build succeeds

- [ ] **Manual Testing Complete**
  - [ ] Verified stores list displays correctly
  - [ ] Pagination works as expected
  - [ ] All actions (View/Revoke/Edit) function properly
  - [ ] Real-time updates work when approving/rejecting stores
  - [ ] Responsive design works on mobile/tablet/desktop

## Manual Testing Checklist

### Basic Flow
1. **View Verified Stores**
   - [ ] Navigate to admin dashboard (`/dashboard/admin`)
   - [ ] Verify "Verified Stores" card appears in 4th column
   - [ ] Confirm verified stores are displayed in table format
   - [ ] Verify columns show: Store Name, Owner, Verified Date, Actions
   - [ ] Check that stores are sorted by verification date (most recent first)

2. **Pagination**
   - [ ] If more than 15 verified stores exist, pagination controls appear
   - [ ] Click "Next" page → Verify correct stores displayed
   - [ ] Click "Previous" page → Returns to previous page
   - [ ] Verify "Showing X-Y of Z stores" text is accurate
   - [ ] Test page number navigation if implemented

3. **View Store Details**
   - [ ] Click "View Details" button on a verified store
   - [ ] Verify navigation to `/dashboard/admin/stores/[id]`
   - [ ] Confirm store details page displays correctly

4. **Revoke Verification**
   - [ ] Click "Revoke Verification" button on a verified store
   - [ ] Confirm dialog appears with store name
   - [ ] Click "Cancel" → Dialog closes, no changes
   - [ ] Click "Revoke" → Store status changes to pending
   - [ ] Verify store disappears from verified list
   - [ ] Verify store appears in pending stores list
   - [ ] Check that `verified_at` timestamp is cleared

5. **Edit Store** (if implemented)
   - [ ] Click "Edit Store" button
   - [ ] Verify navigation to edit page or modal opens
   - [ ] Confirm edit functionality works

### Edge Case Testing
1. **Empty State**
   - [ ] When no verified stores exist, "No verified stores" message displays
   - [ ] Verify empty state styling matches other empty states

2. **Real-time Updates**
   - [ ] Approve a pending store from another tab/window
   - [ ] Verify store appears in verified list without page refresh
   - [ ] Revoke verification for a verified store
   - [ ] Verify store moves to pending list immediately

3. **Pagination Edge Cases**
   - [ ] Test pagination with exactly 15 stores (one page)
   - [ ] Test pagination with 16 stores (two pages)
   - [ ] Test pagination with 100+ stores (multiple pages)
   - [ ] Verify "Previous" button disabled on first page
   - [ ] Verify "Next" button disabled on last page

4. **Responsive Design**
   - [ ] Test on mobile (< 768px) → Should show 1 column
   - [ ] Test on tablet (768px - 1024px) → Should show 2 columns
   - [ ] Test on desktop (> 1024px) → Should show 4 columns
   - [ ] Verify table is scrollable on small screens if needed

### Error Handling
1. **API Errors**
   - [ ] Simulate network error when fetching verified stores
   - [ ] Verify error message displays appropriately
   - [ ] Test revoke verification API error
   - [ ] Confirm error toast appears and store status doesn't change

2. **Invalid Data**
   - [ ] Test with store missing owner information
   - [ ] Test with store missing verification date
   - [ ] Verify component handles null/undefined gracefully

3. **Permission Errors**
   - [ ] Test with non-admin user (should not see admin dashboard)
   - [ ] Verify proper error handling if admin permissions missing

### Integration
1. **Dashboard Integration**
   - [ ] Verify verified stores list doesn't break existing components
   - [ ] Test that all 4 columns (Pending, Activity, Top Stores, Verified) display correctly
   - [ ] Confirm summary cards still show correct counts
   - [ ] Verify charts and other components still function

2. **Store Approval Flow**
   - [ ] Approve a pending store
   - [ ] Verify it appears in verified stores list
   - [ ] Verify it disappears from pending stores list
   - [ ] Confirm real-time updates work correctly

3. **Store Rejection Flow**
   - [ ] Reject a pending store
   - [ ] Verify it doesn't appear in verified stores list
   - [ ] Verify it disappears from pending stores list

4. **Navigation**
   - [ ] Click "View Details" → Navigate to store detail page
   - [ ] Use browser back button → Return to dashboard
   - [ ] Verify dashboard state is preserved

## Technical Details

### Files to Create
- `src/components/dashboard/admin/VerifiedStoresList.tsx`
- `src/components/dashboard/admin/__tests__/VerifiedStoresList.test.tsx`
- `src/app/api/admin/stores/[id]/revoke/route.ts`
- `src/app/api/admin/stores/[id]/revoke/__tests__/route.test.ts`

### Files to Modify
- `src/application/dashboard/admin/getAdminDashboardData.ts` - Add verified stores query with pagination
- `src/components/dashboard/admin/AdminDashboardClient.tsx` - Update to 4-column grid, add VerifiedStoresList
- `messages/en.json` - Add translation keys for verified stores

### Key Implementation Details
- **Layout**: 4-column grid layout (`md:grid-cols-2 lg:grid-cols-4`)
- **Display**: Minimal info (Name, Owner, Verified Date, Actions)
- **Actions**: View Details, Revoke Verification, Edit Store
- **Pagination**: Server-side pagination (recommended) for all verified stores
- **Sorting**: By verification date descending (most recent first)
- **Revoke**: Sets `verification_status` to "pending" (different from reject which sets to "rejected")
- **Real-time**: Uses existing `useAdminRealtime` hook for updates

### Dependencies
- No new external dependencies required
- Uses existing UI components (Card, Table, Badge, Button, AlertDialog, Pagination)
- Uses existing pagination component (`src/components/ui/pagination.tsx`)

## Reference
- Related component: `src/components/dashboard/admin/PendingStoresList.tsx` (reference for table structure)
- Related endpoint: `src/app/api/admin/stores/[id]/approve/route.ts` (reference for API pattern)
- Session context: `.cursor/sessions/context_session_admin_stores_dashboard.md`

