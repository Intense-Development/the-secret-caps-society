# Multilanguage Support Session

## Plan Iterations

- 2025-11-11 Plan v1
  1. **Baseline audit**: catalogue all user-facing copy in `src/app` pages, shared components (`Navbar`, `Hero`, `Footer`, auth forms, dashboard widgets) and any server-rendered messages to create the translation inventory spreadsheet.
  2. **Dependencies & tooling**: add `next-intl` for App Router i18n, plus `@formatjs/intl-localematcher` and `negotiator` for locale negotiation. Update TypeScript config if needed for module resolution. Ensure ESLint rules cover message key usage (optional plugin evaluation).
  3. **Project structure**: introduce `src/i18n/` with `config.ts`, `routing.ts`, and `locale.ts` definitions; create locale message directories `messages/en.json`, `messages/es.json`, `messages/ar.json`. Refactor `src/app` into locale-aware routes (`src/app/[locale]/layout.tsx`, move existing pages under `[locale]`, add redirect route in root `app/page.tsx`).
  4. **Providers & layout**: wrap layouts with `NextIntlClientProvider`, load messages via `getMessages`, set `<html lang>` and `dir` attributes dynamically, and ensure `ThemeProvider`/`QueryProvider` remain functional. Expose server helpers to fetch translations inside Server Components.
  5. **Utilities & hooks**: add `useLocale`, `useChangeLocale`, and formatter helpers (dates, numbers, currency) using `next-intl` utilities; include a generic `formatDate`, `formatCurrency`, `formatNumber` in `src/lib/i18n.ts`.
  6. **Language switcher**: implement a reusable client component in `src/components/LanguageSwitcher.tsx` using `next-intl` navigation helpers for seamless route-localed switching (persist query params, handle dropdown vs inline buttons). Integrate into `Navbar` (desktop + mobile) and expose minimal API for other placements.
  7. **Component localization**: replace hardcoded strings in shared components (`Navbar`, `Hero`, `Footer`, CTA sections, auth forms, dashboard pages, error states) with translation keys. Move dynamic text (e.g., counts) to translation templates with placeholders. Ensure metadata (`generateMetadata`) leverages locale titles/descriptions.
  8. **Localized formatting**: update areas with dates (`Footer` copyright, dashboard timestamps) and numbers (product prices, stats) to use formatter helpers and ensure currency symbol keyed per locale. Provide example for Spanish (EUR or MXN?) and support future overrides.
  9. **Routing & middleware**: extend `middleware.ts` to detect locale from cookies/headers using `next-intl/middleware`, persist selection cookie, and allow bypass for public assets. Ensure protected routes still respect Supabase auth logic alongside locale handling.
 10. **RTL readiness**: configure Tailwind/Global styles to react to `[dir="rtl"]` (e.g., import logical CSS utilities, verify components using margin/padding adjust). Add `dir` toggling tests and identify components needing conditional icons/alignments. Document Arabic message placeholders even if not fully translated yet.
 11. **QA & testing**: add Playwright spec verifying language switching, persisted locale cookie, and localized date/number rendering. If feasible, add lightweight unit tests with `@testing-library/react` + `next-intl` mocks for `LanguageSwitcher`. Update e2e configs to iterate locales.
 12. **Lookbook & docs**: create a Storybook/Lookbook MDX entry (e.g., `docs/lookbook/LanguageSwitcher.mdx`) demonstrating the switcher in LTR and RTL contexts. Update `README.md` and author a dedicated `docs/i18n-guide.md` covering translation workflow, formatting helpers, and adding new locales.
 13. **Migration & rollout**: provide migration checklist (string inventory freeze, translator coordination, fallback message strategy). Plan staging validation focusing on caching, middleware redirects, and integration with Supabase auth flows.
